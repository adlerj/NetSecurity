var IPGetter=function(){return this.callback=null,this};IPGetter.prototype.get=function(e){this.callback=e;var t="http://scarletshield.rutgers.edu/demo/pullips.php";$.get(t,IPGetter.staticHandler(this))},IPGetter.staticHandler=function(e){return function(t){e.handler(t)}},IPGetter.prototype.handler=function(e){var t=e.split(" <br>"),n=[];this.extractIPs(t,n),this.callback(n)},IPGetter.prototype.extractIPs=function(e,t){var n=/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/g;for(var r=0;r<e.length-1;++r){var i=e[r],s=i.match(n);if(s.length!==2)continue;if(s[0].substring(0,3)==="224"||s[1].substring(0,3)==="224")continue;s[0]==="128.6.238.75"?t.push(s[1]):s[1]==="128.6.238.75"&&t.push(s[0])}};var IPLocator=function(){return this.goalWeight=0,this.totalWeight=0,this.goalRequests=0,this.completeRequests=0,this.heatSpots=[],this.container=document.getElementById("map-canvas"),this.callback=null,this};IPLocator.prototype.locate=function(e,t){var n="http://162.248.161.124:8080/json/",r={};for(var i=0;i<e.length;++i){var s=e[i];r[s]?++r[s]:r[s]=1}this.callback=t,this.goalWeight=e.length,this.goalRequests=Object.keys(r).length;var s;for(s in r){var o=r[s];$.getJSON(n+s,IPLocator.successHandler(o,this)).fail(IPLocator.failHandler(o,this))}},IPLocator.successHandler=function(e,t){return function(n){t.handler(e,n)}},IPLocator.failHandler=function(e,t){return function(){t.error(e)}},IPLocator.prototype.isUs=function(e){return Math.floor(Number(e.latitude))===40&&Math.floor(Number(e.longitude))===-75},IPLocator.prototype.handler=function(e,t){(t.latitude!==0||t.longitude!==0)&&!this.isUs(t)&&this.heatSpots.push({location:new google.maps.LatLng(t.latitude,t.longitude),weight:e}),this.totalWeight+=e,this.completeRequests+=1;var n=document.getElementById("progress");n.style.width=this.completeRequests/this.goalRequests*100+"%",this.totalWeight===this.goalWeight&&this.callback(this.heatSpots)},IPLocator.prototype.error=function(e){this.totalWeight+=e,this.completeRequests+=1,this.totalWeight===this.goalWeight&&this.callback(this.heatSpots)};var updateData=function(e){return function(t){$("#overlay").hide();var n=new google.maps.MVCArray(t);e.setData(n)}},translate=function(e){return function(t){$("#overlay").show();var n=new IPLocator;n.locate(t,e)}},getLatestIPs=function(e){var t=new IPGetter;t.get(translate(e))},initialize=function(){var e=new google.maps.LatLng(40,0),t={mapTypeControl:!1,center:e,zoom:2},n=document.getElementById("map-canvas"),r=new google.maps.Map(n,t),i=new google.maps.MVCArray([]),s=new google.maps.visualization.HeatmapLayer({data:i,radius:20});s.setMap(r);var o=["rgba(125, 0, 0, 0)","rgba(135, 0, 0, 1)","rgba(145, 0, 0, 1)","rgba(155, 0, 0, 1)","rgba(165, 0, 0, 1)","rgba(175, 0, 0, 1)","rgba(185, 0, 0, 1)","rgba(195, 0, 0, 1)","rgba(205, 0, 0, 1)","rgba(215, 0, 0, 1)","rgba(225, 0, 0, 1)","rgba(235, 0, 0, 1)","rgba(245, 0, 0, 1)","rgba(255, 0, 0, 1)"];s.set("gradient",o);var u=document.createElement("div"),a=new OptionsButton(u,r,s);u.index=1,r.controls[google.maps.ControlPosition.TOP_RIGHT].push(u),getLatestIPs(updateData(s))};$(document).ready(initialize);var OptionsButton=function(e,t,n){e.style.padding="5px";var r=document.createElement("div");r.className="button",e.appendChild(r);var i=document.createElement("div");i.style.marginTop="45px",e.appendChild(i);var s=document.createElement("div");s.className="options",e.appendChild(s),$(s).hide();var o=new TextOption("Refresh Chart Data",s),u=new TextOption("See past Attacks",s);return google.maps.event.addDomListener(o,"click",function(){$(s).slideToggle(200),$("#progress").width(0),$("#overlay").show(),getLatestIPs(updateData(n))}),google.maps.event.addDomListener(r,"click",function(){$(s).slideToggle(200)}),this},TextOption=function(e,t){var n=document.createElement("div");return n.className="text-option",n.innerHTML=e,t.appendChild(n),google.maps.event.addDomListener(n,"mouseover",function(){$(n).finish().animate({backgroundColor:"#0099FF"},150)}),google.maps.event.addDomListener(n,"mouseout",function(){$(n).finish().animate({backgroundColor:"white"},150)}),n};