var Analytics=function(e){return this.data=e,this.container=document.getElementById("dataArea"),this};Analytics.prototype.init=function(){this.container.innerHTML="";var e=this.createTimeChart(),t=this.createCommonIPs(),n=this.createCommonAttacks();this.hotlinks(e,t,n)},Analytics.prototype.createTimeChart=function(){var e=document.createElement("div");e.classList.add("card","shadow"),this.container.appendChild(e);var t=this.initCard(e),n=document.createElement("div");n.classList.add("onepixline","clear"),t.appendChild(n);var r=document.createElement("div");r.className="entry",t.appendChild(r);var i=document.createElement("div");i.id="dashboard",r.appendChild(i);var s=document.createElement("div");s.id="chart",s.style.width="100%",s.style.height="400px",i.appendChild(s);var o=document.createElement("div");o.id="control",o.style.width="100%",o.style.height="50px",i.appendChild(o);var u=new google.visualization.Dashboard(i),a=new google.visualization.ControlWrapper({controlType:"ChartRangeFilter",containerId:"control",options:{filterColumnIndex:0,ui:{chartType:"LineChart",chartOptions:{chartArea:{width:"90%"},hAxis:{baselineColor:"none"}},minRangeSize:864e5}}}),f=new google.visualization.ChartWrapper({chartType:"ColumnChart",containerId:"chart",options:{chartArea:{height:"80%",width:"80%"},hAxis:{slantedText:!1},legend:{position:"none"}},view:{columns:[{calc:function(e,t){return e.getFormattedValue(t,0)},type:"string"},1]}}),l=new google.visualization.DataTable;l.addColumn("date","Date"),l.addColumn("number","Number of Attacks");var c={},h;for(h=0;h<this.data.length;++h){var p=this.data[h],d=p.datetime.split(/[\s:-]/),v=Number(d[0]),m=Number(d[1]),g=Number(d[2]),y=v+" "+m+" "+g;c[y]?c[y]++:c[y]=1}var b;for(b in c){var w=new Date(b);l.addRow([w,c[b]])}return u.bind(a,f),u.draw(l),e},Analytics.prototype.createCommonIPs=function(){var e=document.createElement("div");e.classList.add("card","shadow"),this.container.appendChild(e);var t=this.initCard(e),n={},r;for(r=0;r<this.data.length;++r){var i=this.data[r];if(i.src.indexOf("128.6.238")!==-1)continue;n[i.src]?n[i.src]++:n[i.src]=1}var s=new google.visualization.DataTable;s.addColumn("string","IP Address"),s.addColumn("number","Number of Occurrences");for(r in n)n[r]&&s.addRow([r,n[r]]);var o={title:"IP Address Occurences"},u=document.createElement("div");u.classList.add("onepixline","clear"),t.appendChild(u);var a=document.createElement("div");a.className="entry",a.style.height="500px",t.appendChild(a);var f=new google.visualization.PieChart(a);f.draw(s,o);for(r=0;r<5;++r){var l,c=0,h=-1;for(l in n)n[l]>c&&(c=n[l],h=l);var p=document.createElement("div");p.classList.add("onepixline","clear"),t.appendChild(p);var d=document.createElement("div");d.className="entry",t.appendChild(d);var v=document.createElement("h2");v.className="entryTitle",v.innerHTML=h,d.appendChild(v);var m=document.createElement("p");m.className="entryDes",m.innerHTML="<span>With</span> "+c+" <span>associated attack records.</span>",d.appendChild(m),n[h]=undefined}return e},Analytics.prototype.createCommonAttacks=function(){var e=document.createElement("div");e.classList.add("card","shadow"),this.container.appendChild(e);var t=this.initCard(e),n={},r;for(r=0;r<this.data.length;++r){var i=this.data[r];if(i.src.indexOf("128.6.238")!==-1)continue;n[i.msg]?n[i.msg]++:n[i.msg]=1}var s=new google.visualization.DataTable;s.addColumn("string","Name of Attack"),s.addColumn("number","Number of Occurrences");for(r in n)n[r]&&s.addRow([r,n[r]]);var o={title:"Attack Occurences"},u=document.createElement("div");u.classList.add("onepixline","clear"),t.appendChild(u);var a=document.createElement("div");a.className="entry",a.style.height="500px",t.appendChild(a);var f=new google.visualization.PieChart(a);f.draw(s,o);for(r=0;r<5;++r){var l,c=0,h=-1;for(l in n)n[l]>c&&(c=n[l],h=l);var p=document.createElement("div");p.classList.add("onepixline","clear"),t.appendChild(p);var d=document.createElement("div");d.className="entry",t.appendChild(d);var v=document.createElement("h2");v.className="entryTitle",v.innerHTML=h,d.appendChild(v);var m=document.createElement("p");m.className="entryDes",m.innerHTML="<span>With</span> "+c+" <span>associated records.</span>",d.appendChild(m),n[h]=undefined}return e},Analytics.prototype.initCard=function(e){var t=document.createElement("div");t.className="redline",e.appendChild(t);var n=document.createElement("div");n.className="inner-card",e.appendChild(n);var r=document.createElement("div");r.className="iconandtext",r.style.width="50%",n.appendChild(r);var i=document.createElement("img");i.className="iticon",i.src="images/pie.png",i.alt="Mmm... pie.",r.appendChild(i);var s=document.createElement("h1");return s.className="ittext",s.innerHTML="Common IPs",r.appendChild(s),n},Analytics.prototype.hotlinks=function(e,t,n){var r=document.getElementById("tc"),i=document.getElementById("ip"),s=document.getElementById("att");r.onclick=function(){scrollTo(document.body,e.getBoundingClientRect().top+window.scrollY,200)},i.onclick=function(){scrollTo(document.body,t.getBoundingClientRect().top+window.scrollY,200)},s.onclick=function(){scrollTo(document.body,n.getBoundingClientRect().top+window.scrollY,200)},window.addEventListener("scroll",function(e){return e.preventDefault(),n.getBoundingClientRect().top<=0?(i.classList.remove("underlined"),r.classList.remove("underlined"),s.classList.contains("underlined")||s.classList.add("underlined")):t.getBoundingClientRect().top<=0?(s.classList.remove("underlined"),r.classList.remove("underlined"),i.classList.contains("underlined")||i.classList.add("underlined")):(i.classList.remove("underlined"),s.classList.remove("underlined"),r.classList.contains("underlined")||r.classList.add("underlined")),!1})};var processData=function(){return function(){var e=JSON.parse(this.responseText),t=new Analytics(e);t.init()}},registerScroll=function(){var e=document.getElementById("content"),t=document.createElement("div");t.className="bottom-space",e.appendChild(t);var n=!1,r=this;window.addEventListener("scroll",function(e){e.preventDefault();var t=window.innerHeight,r=document.getElementsByClassName("bottom-space")[0].getBoundingClientRect().top,i=document.getElementById("sidebar");if(window.scrollY>100){if(n===!1){var s=document.getElementById("pageup");moveToX(s,20,175),n=!0}var i=document.getElementById("sidebar");i.style.position="fixed",i.style.marginTop="-100px"}else{if(n===!0){var s=document.getElementById("pageup");moveToX(s,-150,175),n=!1}i.style.marginTop="0px",i.style.position="static"}return!1})},init=function(){initPageUp(),registerScroll();var e=processData(),t="http://scarletshield.rutgers.edu/demo/pulltest.php";get(t,e)};google.load("visualization","1.1",{packages:["corechart","controls"]}),window.addEventListener("beforeunload",function(){window.scrollTo(0,0)}),document.addEventListener("DOMContentLoaded",init,!1);var get=function(e,t){var n=new XMLHttpRequest;n.onload=t,n.open("get",e,!0),n.send()},moveToX=function(e,t,n){var r=parseInt(e.style.marginLeft),i=t-r,s=0,o=20,u=function(){s+=o;var t=easeInOutQuad(s,r,i,n);e.style.marginLeft=t+"px",s<n&&setTimeout(u,o)};u()},scrollTo=function(e,t,n){var r=e.scrollTop,i=t-r,s=0,o=20,u=function(){s+=o;var t=easeInOutQuad(s,r,i,n);e.scrollTop=t,s<n&&setTimeout(u,o)};u()},easeInOutQuad=function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},initPageUp=function(){var e=document.getElementById("pageup");e.style.marginLeft="-100px",e.style.marginTop=window.innerHeight-150+"px";var t=function(t){e.onmouseup=t},n=function(e){scrollTo(document.body,0,700),setTimeout(t,700,n)};t(n),e.addEventListener("click",function(){e.onmouseup=null}),window.onresize=function(){e.style.marginTop=window.innerHeight-150+"px"}};