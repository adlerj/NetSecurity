var DoubleSlider=function(e,t,n,r,i,s){this.hg=null;var o=document.createElement("div");o.className="slidebar",e.appendChild(o);var u=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),a=o.getBoundingClientRect(),f=Math.floor(a.left+u),l=a.width,c=document.createElement("div");c.className="handle-left";var h=0;e.appendChild(c);var p=document.createElement("div");p.className="handle-right";var d=l-14;p.style.marginLeft=d+"px",e.appendChild(p);var v=!1,m=!1,g=t,y=n,b=t,w=n,E=l-14,S=E/(n-t),x=!1;c.onmousedown=function(){return v=!0,!1},p.onmousedown=function(){return x?v=!0:m=!0,!1};var T=this;document.onmouseup=function(){v&&b!==g&&(b=g,T.hg.setHighPriority(g)),m&&w!==y&&(w=y,T.hg.setLowPriority(y)),v=!1,m=!1,g<n&&(x=!1)},document.onmousemove=function(e){if(v){u=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),a=o.getBoundingClientRect(),f=Math.floor(a.left+u);var r=e.pageX-f,i=Math.floor(r/S+.5)+t;i!==g&&i<=n&&i>=t&&i<=y&&(g=i,c.style.marginLeft=(i-t)*S+"px",C(),i===y&&(x=!0))}else if(m){u=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),a=o.getBoundingClientRect(),f=Math.floor(a.left+u);var r=e.pageX-f,i=Math.floor(r/S+.5)+t;i!==y&&i<=n&&i>=t&&i>=g&&(y=i,p.style.marginLeft=(i-t)*S+"px",C())}};var N=document.createElement("p");N.style.textAlign="center";var C=function(){N.innerHTML=g+" to "+y};return C(),e.appendChild(N),this};DoubleSlider.prototype.registerHG=function(e){this.hg=e};var HistoryGenerator=function(e){this.data=e,this.cur=e.length-1,this.container=document.getElementById("dataArea"),this.lastDate=new Date(0),this.lastCard=null,this.sorting="recent",this.lowPriority=3,this.highPriority=0;var t=document.getElementById("startdate"),n=document.getElementById("enddate"),r=HistoryGenerator.getStartDate(t.value),i=HistoryGenerator.getEndDate(n.value);return this.startDate=r.valueOf(),this.endDate=i.valueOf(),this.search="",this.container.innerHTML="",this};HistoryGenerator.prototype.next20=function(){var e=this.data,t=this.lastDate,n=this.lastCard,r=this.cur,i=0;while(i<20&&r>=0){var s=e[r];if(this.search!==""){var o=s.msg.toLowerCase(),u=s.src,a=s.dst,f=this.search.toLowerCase();console.log();if(o.indexOf(f)===-1&&u.indexOf(f)===-1&&a.indexOf(f)===-1){--r;continue}}var l=s.priority;if(l<this.highPriority||l>this.lowPriority){--r;continue}var c=s.datetime.split(/[\s:-]/),h=Number(c[0]),p=Number(c[1]),d=Number(c[2]),v=Number(c[3]),m=Number(c[4]),g=Number(c[5]),y=new Date(h,p-1,d,v,m,g,0);if(y.valueOf()>this.endDate||y.valueOf()<this.startDate){--r;continue}if(t.toDateString()===y.toDateString())this.appendEntry(s,n,v,m,g);else{var b=this.appendCard(s,h,p,d,v,m,g);n=b,t=y}--r,++i}r<0&&n===null&&this.showError(),this.cur=r,this.lastDate=t,this.lastCard=n},HistoryGenerator.prototype.showError=function(){this.container.innerHTML="<div class='card shadow'><div class='redline'></div><div class='inner-card'><div class='iconandtext'><img class='iticon' src='images/sad.png' alt='Calendar'/><h1 class='ittext'>No Results!</h1></div><div class='error-space'></div></div></div>"},HistoryGenerator.prototype.appendCard=function(e,t,n,r,i,s,o){var u=document.createElement("div");u.classList.add("card","shadow"),this.container.appendChild(u);var a=document.createElement("div");a.className="redline",u.appendChild(a);var f=document.createElement("div");f.className="inner-card",u.appendChild(f);var l=document.createElement("div");l.className="iconandtext",f.appendChild(l);var c=document.createElement("img");c.className="iticon",c.src="images/cal.png",c.alt="Calendar",l.appendChild(c);var h=document.createElement("h1");return h.className="ittext",h.innerHTML=n+"/"+r+"/"+t,l.appendChild(h),this.appendEntry(e,f,i,s,o),f},HistoryGenerator.prototype.appendEntry=function(e,t,n,r,i){var s=t,o=document.createElement("div");o.classList.add("onepixline","clear"),s.appendChild(o);var u=document.createElement("div");u.className="entry",s.appendChild(u);var a=document.createElement("div");a.className="detButton",a.innerHTML="Details",u.appendChild(a);var f=document.createElement("h2");f.className="entryTitle",f.innerHTML=e.msg,u.appendChild(f);var l=document.createElement("p");l.className="entryDes";var c="AM";n===0?n="12":n>12&&(n-=12,c="PM"),r<10&&(r="0"+r),i<10&&(i="0"+i),l.innerHTML="<span>From</span> "+e.src+" <span>at</span> "+n+":"+r+":"+i+c,u.appendChild(l);var h=document.createElement("p");h.className="entryDes",h.innerHTML="<span>Priority</span> "+e.priority,u.appendChild(h);var p=document.createElement("div");p.style.display="none",u.appendChild(p);var d=document.createElement("p");d.className="entryDes",d.innerHTML="<span>Source IP: </span>"+e.src+"<span>, Destination IP: </span>"+e.dst,p.appendChild(d);var v=document.createElement("p");v.className="entryDes",v.innerHTML="<span>CID: </span>"+e.cid,p.appendChild(v);var m=document.createElement("p");m.className="entryDes",p.appendChild(m);var g=!1,y=!1;a.onclick=function(){if(g===!1){if(y===!1){var t="http://162.248.161.124:8080/json/";get(t+e.src,function(){var e=JSON.parse(this.responseText),t="";e.region_name!==""&&(t+=e.region_name+", "),e.country_name!==""&&(t+=e.country_name),t===""?t="Location unknown.":t="<span>Location: </span>"+t,m.innerHTML=t}),y=!0}p.style.display="block",g=!0}else p.style.display="none",g=!1}},HistoryGenerator.prototype.registerScroll=function(){var e=document.getElementById("content"),t=document.createElement("div");t.className="bottom-space",e.appendChild(t);var n=!1,r=this;window.onscroll=function(e){e.preventDefault();var t=window.innerHeight,i=document.getElementsByClassName("bottom-space")[0].getBoundingClientRect().top;i<t&&r.next20();var s=document.getElementById("sidebar");if(window.scrollY>100){if(n===!1){var o=document.getElementById("pageup");moveToX(o,20,175),n=!0}var s=document.getElementById("sidebar");s.style.position="fixed",s.style.marginTop="-100px"}else{if(n===!0){var o=document.getElementById("pageup");moveToX(o,-150,175),n=!1}s.style.marginTop="0px",s.style.position="static"}return!1}},HistoryGenerator.prototype.sortBy=function(e){e==="recent"?this.sorting==="oldest"?this.data.reverse():this.data.sort(function(e,t){return e.id-t.id}):e==="oldest"?this.sorting==="recent"?this.data.reverse():this.data.sort(function(e,t){return t.id-e.id}):e==="pinc"?this.data.sort(function(e,t){var n=e.priority-t.priority;return n===0?e.id-t.id:n}):e==="pdec"&&this.data.sort(function(e,t){var n=t.priority-e.priority;return n===0?e.id-t.id:n}),this.refreshUs(),this.sorting=e,console.log(this)},HistoryGenerator.prototype.refreshUs=function(){window.scrollTo(0,0),this.cur=this.data.length-1,this.container.innerHTML="",this.lastDate=new Date(0),this.lastCard=null,this.next20()},HistoryGenerator.prototype.registerSelector=function(){var e=document.getElementById("selector"),t=this;e.onchange=function(){t.sortBy(e.value)}},HistoryGenerator.prototype.registerDates=function(){var e=document.getElementById("startdate"),t=document.getElementById("enddate"),n=this;e.onblur=function(){var t=HistoryGenerator.getStartDate(e.value);n.startDate=t.valueOf(),n.refreshUs()},t.onblur=function(){var e=HistoryGenerator.getEndDate(t.value);n.endDate=e.valueOf(),n.refreshUs()}},HistoryGenerator.prototype.registerSearch=function(){var e=document.getElementById("searchbox"),t=document.getElementById("searchsubmit"),n=this;t.onclick=function(){var t=e.value;n.search=t,n.refreshUs()},e.onkeypress=function(t){if(t.keyCode===13){var r=e.value;n.search=r,n.refreshUs()}}},HistoryGenerator.getStartDate=function(e){var t=e.split("-"),n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),s=new Date(n,r-1,i,0,0,0,0);return s},HistoryGenerator.getEndDate=function(e){var t=e.split("-"),n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),s=new Date(n,r-1,i,23,59,59,999);return s},HistoryGenerator.prototype.setHighPriority=function(e){this.highPriority=e,this.refreshUs()},HistoryGenerator.prototype.setLowPriority=function(e){this.lowPriority=e,this.refreshUs()};var initSlider=function(){var e=document.getElementsByClassName("slider")[0],t=new DoubleSlider(e,0,3);return t},processData=function(e){return function(){var t=JSON.parse(this.responseText),n=new HistoryGenerator(t);n.next20(),n.registerScroll(),n.registerSelector(),n.registerDates(),n.registerSearch(),e.registerHG(n)}},initPageUp=function(){var e=document.getElementById("pageup");e.style.marginLeft="-100px",e.style.marginTop=window.innerHeight-150+"px";var t=function(t){e.onmouseup=t},n=function(e){scrollTo(document.body,0,700),setTimeout(t,700,n)};t(n),e.addEventListener("click",function(){e.onmouseup=null}),window.onresize=function(){e.style.marginTop=window.innerHeight-150+"px"}},initToday=function(){var e=document.getElementById("enddate"),t=new Date,n=t.getMonth()+1;n<10&&(n="0"+n);var r=t.getDate();r<10&&(r="0"+r),e.value=t.getFullYear()+"-"+n+"-"+r},init=function(){initToday(),initPageUp();var e=initSlider(),t=processData(e),n="http://scarletshield.rutgers.edu/demo/pulltest.php";get(n,t)};window.addEventListener("beforeunload",function(){window.scrollTo(0,0)}),document.addEventListener("DOMContentLoaded",init,!1);var get=function(e,t){var n=new XMLHttpRequest;n.onload=t,n.open("get",e,!0),n.send()},moveToX=function(e,t,n){var r=parseInt(e.style.marginLeft),i=t-r,s=0,o=20,u=function(){s+=o;var t=easeInOutQuad(s,r,i,n);e.style.marginLeft=t+"px",s<n&&setTimeout(u,o)};u()},scrollTo=function(e,t,n){var r=e.scrollTop,i=t-r,s=0,o=20,u=function(){s+=o;var t=easeInOutQuad(s,r,i,n);e.scrollTop=t,s<n&&setTimeout(u,o)};u()},easeInOutQuad=function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)};